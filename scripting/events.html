<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>监听和发射事件</title>
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="../assets/css/style.css"/>
    <link rel="shortcut icon" type="image/ico" href="../assets/favicon.ico">
  </head>
  <body>
  <div class="full-wrap">
    <div class="sidebar markdown-body">
      <div class="inner">
        <div class="logo">
          <a href="../index.html"><img src="../assets/img/logo.png"></a>
        </div>
        <ul class="nav nav-list">
          <li class="sidebar-header-1 "><h3><a href="../getting-started/index.html">Cocos Creator 入门</a></h3></li>
          <li class=" sidebar-header-3"><a href="../getting-started/introduction.html">关于 Cocos Creator</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/install.html">安装和启动</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/dashboard.html">使用 Dashboard</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/hello-world.html">Hello World!</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/quick-start.html">快速上手: 制作第一个游戏</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/cocos2d-x-guide.html">Cocos2d-x 用户上手指南</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/unity-guide.html">Unity 用户上手指南</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/project-structure.html">项目结构</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/support.html">获取帮助和支持</a></li>
          <li class="sidebar-header-1 "><h3><a href="../basics/index.html">编辑器基础</a></h3></li>
          <li class=" sidebar-header-3"><a href="../basics/editor-overview.html">编辑器界面介绍</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/assets.html">资源管理器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/scene.html">场景编辑器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/hierarchy.html">层级管理器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/inspector.html">属性检查器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/console.html">控制台</a></li>
          <li class=" sidebar-header-3"><a href="../basics/toolbar.html">工具栏</a></li>
          <li class=" sidebar-header-3"><a href="../basics/layout.html">编辑器布局</a></li>
          <li class="sidebar-header-1 "><h3><a href="../asset-workflow/index.html">资源工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/scene-managing.html">创建和管理场景</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/sprite.html">图像资源（Texture）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/atlas.html">图集资源（Atlas）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/font.html">字体资源</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/particle.html">粒子资源</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/audio-asset.html">声音资源（AudioClip）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/prefab.html">预制资源（Prefab）</a></li>
          <li class="sidebar-header-1 "><h3><a href="../content-workflow/index.html">内容创作工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="../content-workflow/node-component.html">节点和组件</a></li>
          <li class=" sidebar-header-3"><a href="../content-workflow/transform.html">坐标系和变换</a></li>
          <li class=" sidebar-header-3"><a href="../content-workflow/node-tree.html">管理节点层级和显示顺序</a></li>
          <li class=" sidebar-header-3"><a href="../content-workflow/scene-editing.html">使用场景编辑器搭建场景图像</a></li>
          <li class="sidebar-header-1 "><h3><a href="../ui/index.html">UI 系统</a></h3></li>
          <li class=" sidebar-header-3"><a href="../ui/sliced-sprite.html">使用 Sliced Sprite 制作 UI 图像</a></li>
          <li class=" sidebar-header-3"><a href="../ui/multi-resolution.html">多分辨率适配方案</a></li>
          <li class=" sidebar-header-3"><a href="../ui/widget-align.html">对齐策略</a></li>
          <li class=" sidebar-header-3"><a href="../ui/label-layout.html">文字排版</a></li>
          <li class=" sidebar-header-3"><a href="../ui/ui-components.html">常用 UI 控件</a></li>
          <li class=" sidebar-header-3"><a href="../ui/auto-layout.html">自动布局容器</a></li>
          <li class=" sidebar-header-3"><a href="../ui/list-with-data.html">制作动态生成内容的列表</a></li>
          <li class="sidebar-header-1 "><h3><a href="../animation/index.html">动画系统</a></h3></li>
          <li class=" sidebar-header-3"><a href="../animation/animation.html">关于 Animation</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-clip.html">创建 Animation 组件和动画剪辑</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-curve.html">编辑动画曲线</a></li>
          <li class=" sidebar-header-3"><a href="../animation/sprite-animation.html">编辑序列帧动画</a></li>
          <li class=" sidebar-header-3"><a href="../animation/time-curve.html">编辑时间曲线</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-event.html">添加动画事件</a></li>
          <li class=" sidebar-header-3"><a href="../animation/scripting-animation.html">使用脚本控制动画</a></li>
          <li class="sidebar-header-1 "><h3><a href="../components/index.html">组件参考</a></h3></li>
          <li class=" sidebar-header-3"><a href="../components/sprite.html">Sprite 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/label.html">Label 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/animation.html">Animation 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/canvas.html">Canvas 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/widget.html">Widget 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/progress.html">ProgressBar 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/button.html">Button 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/mask.html">Mask 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/scrollview.html">ScrollView 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/scrollbar.html">ScrollBar 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/layout.html">Layout 组件参考</a></li>
          <li class="sidebar-header-1 "><h3><a href="index.html">脚本开发工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="use-component.html">创建和使用组件脚本</a></li>
          <li class=" sidebar-header-3"><a href="properties.html">声明属性</a></li>
          <li class=" sidebar-header-3"><a href="access-node-component.html">访问节点和其他组件</a></li>
          <li class=" sidebar-header-3"><a href="life-cycle-callbacks.html">生命周期回调</a></li>
          <li class=" sidebar-header-3"><a href="create-destroy.html">创建和销毁节点</a></li>
          <li class="active sidebar-header-3"><a href="events.html">发射和监听事件</a></li>
          <li class=" sidebar-header-3"><a href="internal-events.html">系统内置事件</a></li>
          <li class=" sidebar-header-3"><a href="actions.html">使用动作系统</a></li>
          <li class=" sidebar-header-3"><a href="action-list.html">动作列表</a></li>
          <li class=" sidebar-header-3"><a href="scheduler.html">使用计时器</a></li>
          <li class=" sidebar-header-3"><a href="execution-order.html">脚本执行顺序</a></li>
          <li class=" sidebar-header-3"><a href="pooling.html">使用对象池</a></li>
          <li class=" sidebar-header-3"><a href="load-assets.html">获取资源</a></li>
          <li class=" sidebar-header-3"><a href="modular-script.html">模块化脚本</a></li>
          <li class=" sidebar-header-3"><a href="web-debug-scripts.html">在浏览器中调试脚本</a></li>
          <li class=" sidebar-header-3"><a href="javascript-primer.html">JavaScript 快速入门</a></li>
          <li class=" sidebar-header-4"><a href="reference/attributes.html">属性参数参考</a></li>
          <li class="sidebar-header-1 "><h3><a href="../publish/index.html">跨平台发布游戏</a></h3></li>
          <li class=" sidebar-header-3"><a href="../publish/publish-web.html">发布到 Web 平台</a></li>
          <li class=" sidebar-header-3"><a href="../publish/cocos-framework.html">安装配置 Cocos Framework</a></li>
          <li class=" sidebar-header-3"><a href="../publish/publish-native.html">打包发布原生平台</a></li>
        </ul>
      </div>
    </div>
    <div class="main">
      <article class="markdown-body"><h1 id="-">监听和发射事件</h1>
<h2 id="--1">监听事件</h2>
<p>事件处理是在节点（<code>cc.Node</code>）中完成的。对于组件，可以通过访问节点 <code>this.node</code> 来注册和监听事件。监听事件可以
通过 <code>this.node.on()</code> 函数来注册，方法如下：</p>
<pre class="hljs"><code>cc.Class({
  extends: cc.Component,

  properties: {
  },

  onLoad: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> event </span>) </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello!'</span>);
    });
  },  
});</code></pre><p>值得一提的是，事件监听函数 <code>on</code> 可以传第三个参数 target，用于绑定响应函数的调用者。以下两种调用方式，
效果上是相同的：</p>
<pre class="hljs"><code><span class="hljs-comment">// 使用函数绑定</span>
<span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> event </span>) </span>{
  <span class="hljs-keyword">this</span>.enabled = <span class="hljs-literal">false</span>;
}.bind(<span class="hljs-keyword">this</span>));

<span class="hljs-comment">// 使用第三个参数</span>
<span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
  <span class="hljs-keyword">this</span>.enabled = <span class="hljs-literal">false</span>;
}, <span class="hljs-keyword">this</span>);</code></pre><p>除了使用 <code>on</code> 监听，我们还可以使用 <code>once</code> 方法。<code>once</code> 监听在监听函数响应后就会关闭监听事件。</p>
<h3 id="--2">关闭监听</h3>
<p>当我们不再关心某个事件时，我们可以使用 <code>off</code> 方法关闭对应的监听事件。需要注意的是，<code>off</code> 方法的
参数必须和 <code>on</code> 方法的参数一一对应，才能完成关闭。</p>
<p>我们推荐的书写方法如下：</p>
<pre class="hljs"><code>cc.Class({
  extends: cc.Component,

  _sayHello: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello World'</span>);
  },

  onEnable: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'foobar'</span>, <span class="hljs-keyword">this</span>._sayHello, <span class="hljs-keyword">this</span>);
  },

  onDisable: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.node.off(<span class="hljs-string">'foobar'</span>, <span class="hljs-keyword">this</span>._sayHello, <span class="hljs-keyword">this</span>);
  },
});</code></pre><h2 id="--3">发射事件</h2>
<p>我们可以通过两种方式发射事件：<code>emit</code> 和 <code>dispatchEvent</code>。两者的区别在于，后者可以做事件传递。
我们先通过一个简单的例子来了解 <code>emit</code> 事件：</p>
<pre class="hljs"><code>cc.Class({
  extends: cc.Component,

  onLoad: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'say-hello'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
      <span class="hljs-built_in">console</span>.log(event.detail.msg);
    });
  },

  start: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.node.emit(<span class="hljs-string">'say-hello'</span>, {
      msg: <span class="hljs-string">'Hello, this is Cocos Creator'</span>,
    });
  },
});</code></pre><h2 id="--4">派送事件</h2>
<p>上文提到了 <code>dispatchEvent</code> 方法，通过该方法发射的事件，会进入事件派送阶段。在 Cocos Creator
的事件派送系统中，我们采用冒泡派送的方式。冒泡派送会将事件从事件发起节点，不断地向上传递给他的父级
节点，直到到达根节点或者在某个节点的响应函数中做了中断处理 <code>event.stopPropagation()</code>。</p>
<p class="img-container"><img src="assets/bubble-event.png" alt="bubble-event"></p>
<p>如上图所示，当我们从节点 c 发送事件 “foobar”，倘若节点 a，b 均做了 “foobar” 事件的监听，则
事件会经由 c 依次传递给 b，a 节点。如：</p>
<pre class="hljs"><code><span class="hljs-comment">// 节点 c 的组件脚本中</span>
<span class="hljs-keyword">this</span>.node.dispatchEvent( <span class="hljs-keyword">new</span> cc.Event(<span class="hljs-string">'foobar'</span>, <span class="hljs-literal">true</span>) );</code></pre><p>如果我们希望在 b 节点截获事件后就不再将事件传递，我们可以通过调用 <code>event.stopPropagation()</code> 函数
来完成。具体方法如下：</p>
<pre class="hljs"><code><span class="hljs-comment">// 节点 b 的组件脚本中</span>
<span class="hljs-keyword">this</span>.node.on(<span class="hljs-string">'foobar'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
  event.stopPropagation();
});</code></pre><h2 id="--5">事件对象</h2>
<p>在事件监听回调中，开发者会接收到一个 <code>cc.Event</code> 类型的事件对象 <code>event</code>，<code>stopPropagation</code> 就是 <code>cc.Event</code> 的标准 API，其它重要的 API 包含：</p>
<table>
<thead>
<tr>
<th>API 名</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td style="text-align:center"><code>String</code></td>
<td style="text-align:center">事件的类型（事件名）</td>
</tr>
<tr>
<td><code>target</code></td>
<td style="text-align:center"><code>cc.Node</code></td>
<td style="text-align:center">接收到事件的原始对象</td>
</tr>
<tr>
<td><code>currentTarget</code></td>
<td style="text-align:center"><code>cc.Node</code></td>
<td style="text-align:center">接收到事件的当前对象，事件在冒泡阶段当前对象可能与原始对象不同</td>
</tr>
<tr>
<td><code>getType</code></td>
<td style="text-align:center"><code>Funciton</code></td>
<td style="text-align:center">获取事件的类型</td>
</tr>
<tr>
<td><code>stopPropagation</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">停止冒泡阶段，事件将不会继续向父节点传递，当前节点的剩余监听器仍然会接收到事件</td>
</tr>
<tr>
<td><code>stopPropagationImmediate</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">立即停止事件的传递，事件将不会传给父节点以及当前节点的剩余监听器</td>
</tr>
<tr>
<td><code>getCurrentTarget</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">获取当前接收到事件的目标节点</td>
</tr>
<tr>
<td><code>detail</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">自定义事件的信息（属于 <code>cc.Event.EventCustom</code>）</td>
</tr>
<tr>
<td><code>setUserData</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">设置自定义事件的信息（属于 <code>cc.Event.EventCustom</code>）</td>
</tr>
<tr>
<td><code>getUserData</code></td>
<td style="text-align:center"><code>Function</code></td>
<td style="text-align:center">获取自定义事件的信息（属于 <code>cc.Event.EventCustom</code>）</td>
</tr>
</tbody>
</table>
<p>完整的 API 列表可以参考 <code>cc.Event</code> 及其子类的 API 文档。</p>
<h2 id="--6">系统内置事件</h2>
<p>以上是通用的事件监听和发射规则，在 Cocos Creator 中为 <code>cc.Node</code> 内置了鼠标、触摸等系统事件，可参考<a href="./internal-events.html">系统内置事件文档</a>。</p>
      </article>
    </div>
  </div>
  <script src="../assets/js/anchor.min.js"></script>
  <script>
    anchors.add('article h2, article h3, article h4');
  </script>
  </body>
</html>
