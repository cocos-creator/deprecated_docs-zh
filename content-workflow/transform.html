<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>坐标系和节点变换属性</title>
    <link type="text/css" rel="stylesheet" href="../assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="../assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="../assets/css/style.css"/>
    <link rel="shortcut icon" type="image/ico" href="../assets/favicon.ico">
  </head>
  <body>
  <div class="full-wrap">
    <div class="sidebar markdown-body">
      <div class="inner">
        <div class="logo">
          <a href="../index.html"><img src="../assets/img/logo.png"></a>
        </div>
        <ul class="nav nav-list">
          <li class="sidebar-header-1 "><h3><a href="../getting-started/index.html">Cocos Creator 入门</a></h3></li>
          <li class=" sidebar-header-3"><a href="../getting-started/introduction.html">关于 Cocos Creator</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/install.html">安装和启动</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/dashboard.html">使用 Dashboard</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/hello-world.html">Hello World!</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/quick-start.html">快速上手: 制作第一个游戏</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/cocos2d-x-guide.html">Cocos2d-x 用户上手指南</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/unity-guide.html">Unity 用户上手指南</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/project-structure.html">项目结构</a></li>
          <li class=" sidebar-header-3"><a href="../getting-started/support.html">获取帮助和支持</a></li>
          <li class="sidebar-header-1 "><h3><a href="../basics/index.html">编辑器基础</a></h3></li>
          <li class=" sidebar-header-3"><a href="../basics/editor-overview.html">编辑器界面介绍</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/assets.html">资源管理器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/scene.html">场景编辑器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/hierarchy.html">层级管理器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/inspector.html">属性检查器</a></li>
          <li class=" sidebar-header-4"><a href="../basics/editor-panels/console.html">控制台</a></li>
          <li class=" sidebar-header-3"><a href="../basics/toolbar.html">工具栏</a></li>
          <li class=" sidebar-header-3"><a href="../basics/layout.html">编辑器布局</a></li>
          <li class="sidebar-header-1 "><h3><a href="../asset-workflow/index.html">资源工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/scene-managing.html">创建和管理场景</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/sprite.html">图像资源（Texture）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/atlas.html">图集资源（Atlas）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/font.html">字体资源</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/particle.html">粒子资源</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/audio-asset.html">声音资源（AudioClip）</a></li>
          <li class=" sidebar-header-3"><a href="../asset-workflow/prefab.html">预制资源（Prefab）</a></li>
          <li class="sidebar-header-1 "><h3><a href="index.html">内容创作工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="node-component.html">节点和组件</a></li>
          <li class="active sidebar-header-3"><a href="transform.html">坐标系和变换</a></li>
          <li class=" sidebar-header-3"><a href="node-tree.html">管理节点层级和显示顺序</a></li>
          <li class=" sidebar-header-3"><a href="scene-editing.html">使用场景编辑器搭建场景图像</a></li>
          <li class="sidebar-header-1 "><h3><a href="../ui/index.html">UI 系统</a></h3></li>
          <li class=" sidebar-header-3"><a href="../ui/sliced-sprite.html">使用 Sliced Sprite 制作 UI 图像</a></li>
          <li class=" sidebar-header-3"><a href="../ui/multi-resolution.html">多分辨率适配方案</a></li>
          <li class=" sidebar-header-3"><a href="../ui/widget-align.html">对齐策略</a></li>
          <li class=" sidebar-header-3"><a href="../ui/label-layout.html">文字排版</a></li>
          <li class=" sidebar-header-3"><a href="../ui/ui-components.html">常用 UI 控件</a></li>
          <li class=" sidebar-header-3"><a href="../ui/auto-layout.html">自动布局容器</a></li>
          <li class=" sidebar-header-3"><a href="../ui/list-with-data.html">制作动态生成内容的列表</a></li>
          <li class="sidebar-header-1 "><h3><a href="../animation/index.html">动画系统</a></h3></li>
          <li class=" sidebar-header-3"><a href="../animation/animation.html">关于 Animation</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-clip.html">创建 Animation 组件和动画剪辑</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-curve.html">编辑动画曲线</a></li>
          <li class=" sidebar-header-3"><a href="../animation/sprite-animation.html">编辑序列帧动画</a></li>
          <li class=" sidebar-header-3"><a href="../animation/time-curve.html">编辑时间曲线</a></li>
          <li class=" sidebar-header-3"><a href="../animation/animation-event.html">添加动画事件</a></li>
          <li class=" sidebar-header-3"><a href="../animation/scripting-animation.html">使用脚本控制动画</a></li>
          <li class="sidebar-header-1 "><h3><a href="../components/index.html">组件参考</a></h3></li>
          <li class=" sidebar-header-3"><a href="../components/sprite.html">Sprite 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/label.html">Label 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/animation.html">Animation 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/canvas.html">Canvas 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/widget.html">Widget 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/progress.html">ProgressBar 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/button.html">Button 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/mask.html">Mask 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/scrollview.html">ScrollView 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/scrollbar.html">ScrollBar 组件参考</a></li>
          <li class=" sidebar-header-3"><a href="../components/layout.html">Layout 组件参考</a></li>
          <li class="sidebar-header-1 "><h3><a href="../scripting/index.html">脚本开发工作流程</a></h3></li>
          <li class=" sidebar-header-3"><a href="../scripting/use-component.html">创建和使用组件脚本</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/properties.html">声明属性</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/access-node-component.html">访问节点和其他组件</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/life-cycle-callbacks.html">生命周期回调</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/create-destroy.html">创建和销毁节点</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/events.html">发射和监听事件</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/internal-events.html">系统内置事件</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/actions.html">使用动作系统</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/action-list.html">动作列表</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/scheduler.html">使用计时器</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/execution-order.html">脚本执行顺序</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/pooling.html">使用对象池</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/load-assets.html">获取资源</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/modular-script.html">模块化脚本</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/web-debug-scripts.html">在浏览器中调试脚本</a></li>
          <li class=" sidebar-header-3"><a href="../scripting/javascript-primer.html">JavaScript 快速入门</a></li>
          <li class=" sidebar-header-4"><a href="../scripting/reference/attributes.html">属性参数参考</a></li>
          <li class="sidebar-header-1 "><h3><a href="../publish/index.html">跨平台发布游戏</a></h3></li>
          <li class=" sidebar-header-3"><a href="../publish/publish-web.html">发布到 Web 平台</a></li>
          <li class=" sidebar-header-3"><a href="../publish/cocos-framework.html">安装配置 Cocos Framework</a></li>
          <li class=" sidebar-header-3"><a href="../publish/publish-native.html">打包发布原生平台</a></li>
        </ul>
      </div>
    </div>
    <div class="main">
      <article class="markdown-body"><h1 id="-">坐标系和节点变换属性</h1>
<p>在 <a href="../basics/editor-panels/scene.html">场景编辑器</a> 和 <a href="./node-component.html">节点和组件</a> 文档中，我们介绍了可以通过 <strong>变换工具</strong> 和编辑 <strong>属性检查器</strong> 中节点的属性来变更节点的显示行为。这一节我们将会深入了解节点所在场景空间的坐标系，以及节点位置（Position）、旋转（Rotation）、缩放（Scale）、尺寸（Size）四大变换属性的工作原理。</p>
<h2 id="cocos-creator-">Cocos Creator 坐标系</h2>
<p>我们已经知道可以为节点设置位置属性，那么一个有着特定位置属性的节点在游戏运行时将会呈现在屏幕上的什么位置呢？就好像日常生活的地图上有了经度和纬度才能进行卫星定位，我们也要先了解 Cocos Creator 的坐标系，才能理解节点位置的意义。</p>
<h3 id="--1">笛卡尔坐标系</h3>
<p>Cocos Creator 的坐标系和 cocos2d-x 引擎坐标系完全一致，而 cocos2d-x 和 OpenGL 坐标系相同，都是起源于笛卡尔坐标系。笛卡尔坐标系中定义右手系原点在左下角，x 向右，y 向上，z 向外，我们使用的坐标系就是笛卡尔右手系。</p>
<p class="img-container"><img src="transform/right_hand.png" alt="right hand"></p>
<h3 id="-cocos2d-x-">屏幕坐标系和 cocos2d-x 坐标系</h3>
<p>标准屏幕坐标系使用和 OpenGL 不同的坐标系，和 cocos2d-x 坐标系有很大区别。</p>
<p>在 iOS, Android, Windows Phone 等平台用原生 SDK 开发应用时使用的是标准屏幕坐标系，原点为屏幕左上角，x 向右，y 向下。</p>
<p>Cocos2d-x 坐标系和 OpenGL 坐标系一样，原点为屏幕左下角，x 向右，y 向上。</p>
<p class="img-container"><img src="transform/screen_vs_world.png" alt="screen vs cocos"></p>
<h3 id="-world-coordinate-local-coordinate-">世界坐标系（World Coordinate）和本地坐标系（Local Coordinate）</h3>
<p>世界坐标系也叫做绝对坐标系，在 Cocos Creator 游戏开发中表示场景空间内的统一坐标体系，「世界」就用来表示我们的游戏场景。</p>
<p>本地坐标系也叫相对坐标系，是和节点相关联的坐标系。每个节点都有独立的坐标系，当节点移动或改变方向时，和该节点关联的坐标系将随之移动或改变方向。</p>
<p>Cocos Creator 中的 <strong>节点（Node）</strong> 之间可以有父子关系的层级结构，我们修改节点的 <strong>位置（Position）</strong> 属性设定的节点位置是该节点相对于父节点的 <strong>本地坐标系</strong> 而非世界坐标系。最后在绘制整个场景时 Cocos Creator 会把这些节点的本地坐标映射成世界坐标系坐标。</p>
<p>要确定每个节点坐标系的作用方式，我们还需要了解 <strong>锚点</strong> 的概念。</p>
<h3 id="-anchor-">锚点（Anchor）</h3>
<p><strong>锚点（Anchor）</strong> 是节点的另一个重要属性，它决定了节点以自身约束框中的哪一个点作为整个节点的位置。我们选中节点后看到变换工具出现的位置就是节点的锚点位置。</p>
<p>锚点由 <code>anchorX</code> 和 <code>anchorY</code> 两个值表示，他们是通过节点尺寸计算锚点位置的乘数因子，范围都是 <code>0 ~ 1</code> 之间。<code>(0.5, 0.5)</code> 表示锚点位于节点长度乘 0.5 和宽度乘 0.5 的地方，即节点的中心。</p>
<p class="img-container"><img src="transform/anchor_center.png" alt="anchor center"></p>
<p>锚点属性设为 <code>(0, 0)</code> 时，锚点位于节点本地坐标系的初始原点位置，也就是节点约束框的左下角。</p>
<p class="img-container"><img src="transform/anchor_left_bottom.png" alt="anchor left bottom"></p>
<h3 id="--2">子节点的本地坐标系</h3>
<p>锚点位置确定后，所有子节点就会以 <strong>锚点所在位置</strong> 作为坐标系原点，注意这个行为和 cocos2d-x 引擎中的默认行为不同，是 Cocos Creator 坐标系的特色！</p>
<p>假设场景中节点的结构如下图所示：</p>
<p class="img-container"><img src="transform/node_tree.png" alt="node tree"></p>
<p>当我们的场景中包含不同层级的节点时，我们按照以下的流程确定每个节点在世界坐标系下的位置：</p>
<ol class="list">
<li>从场景根级别开始处理每个节点，上图中 <code>NodeA</code> 就是一个根级别节点。首先根据 NodeA 的 <strong>位置（Position）</strong> 属性和 <strong>锚点（Anchor）</strong> 属性，在世界坐标系中确定 NodeA 的显示位置和坐标系原点位置（和锚点位置一致）。</li>
<li>接下来处理 NodeA 的所有直接子节点，也就是上图中 <code>NodeB</code> 以及和 NodeB 平级的节点。根据 NodeB 的位置和锚点属性，在 NodeA 的本地坐标系中确定 NodeB 在场景空间中的位置和坐标系原点位置。</li>
<li>之后不管有多少级节点，都继续按照层级高低依次处理，每个节点都使用父节点的坐标系和自身位置锚点属性来确定在场景空间中的位置。</li>
</ol>
<h2 id="--3">变换属性</h2>
<p>除了上面介绍过的 <strong>锚点（Anchor）</strong> 之外，节点还包括四个主要的变换属性，下面我们依次介绍。</p>
<p class="img-container"><img src="transform/transform_properties.png" alt="transform properties"></p>
<h3 id="-position-">位置（Position）</h3>
<p><strong>位置（Position）</strong> 由 <code>x</code> 和 <code>y</code> 两个属性组成，分别规定了节点在当前坐标系 x 轴和 y 轴上的坐标。</p>
<p class="img-container"><img src="transform/position.png" alt="position"></p>
<p>上图中节点 <code>NodeA</code> 位于场景根级别，他的位置是 <code>(507, 354)</code>（可以参考 <strong>场景编辑器</strong> 背景的刻度显示），其子节点 <code>NodeC</code> 的位置是 <code>(345, 0)</code>，可以看到子节点的位置是以父节点锚点为基准来偏移的。</p>
<p>位置属性的默认值是 <code>(0, 0)</code>，也就是说，新添加节点时，节点总会出现在父节点的坐标系原点位置。Cocos Creator 中节点的默认位置为 <code>(0, 0)</code>，默认锚点设为 <code>(0.5, 0.5)</code>。这样子节点会默认出现在父节点的中心位置，在制作 UI 或组合玩家角色时都能够对所有内容一览无余。</p>
<p>在场景编辑器中，可以随时使用 <a href="../basics/editor-panels/scene.html#--9">移动变换工具</a> 来修改节点位置。</p>
<h3 id="-rotation-">旋转（Rotation）</h3>
<p><strong>旋转（Rotation）</strong> 是另外一个会对节点本地坐标系产生影响的重要属性，旋转属性只有一个值，表示节点当前的旋转角度。角度值为正时，节点顺时针旋转，角度值为负时，节点逆时针旋转。</p>
<p class="img-container"><img src="transform/rotation.png" alt="rotation"></p>
<p>上图所示的节点层级关系和前一张图相同，只是节点 <code>NodeA</code> 的 <strong>旋转（Rotation）</strong> 属性设为了 <code>30</code> 度，可以看到除了 <code>NodeA</code> 本身顺时针旋转了 30 度之外，其子节点 <code>NodeC</code> 也以 <code>NodeA</code> 的锚点为中心，顺时针旋转了 30 度。</p>
<p>在场景编辑器中，可以随时使用 <a href="../basics/editor-panels/scene.html#--10">旋转变换工具</a> 来修改节点旋转。</p>
<h3 id="-scale-">缩放（Scale）</h3>
<p><strong>缩放（Scale）</strong> 属性也是一组乘数因子，由 <code>scaleX</code> 和 <code>scaleY</code> 两个值组成，分别表示节点在 x 轴和 y 轴的缩放倍率。</p>
<p class="img-container"><img src="transform/scale.png" alt="scale"></p>
<p>上图中节点 <code>NodeA</code> 的缩放属性设为 <code>(0.5, 1.0)</code>，也就是将该节点在 x 轴方向缩小到原来的 0.5 倍，y 轴保持不变。可以看到子节点 <code>NodeC</code> 图像也在 x 轴方向上进行了压缩，所以缩放属性会影响所有子节点。</p>
<p>子节点上设置的缩放属性会和父节点叠加作用，子节点的子节点会将每一层级的缩放属性全部相乘来获得在世界坐标系下显示的缩放倍率，这一点和位置、旋转其实是一致的，只不过位置和旋转属性是相加作用，只有缩放属性是相乘，作用表现的更明显。</p>
<p>缩放属性是叠加在位置、尺寸等属性上作用的，修改缩放属性时，节点的位置和尺寸不会变化，但显示节点图像时会先将位置和尺寸等属性和缩放相乘，得出的数值才是节点显示的真实位置和大小。</p>
<p>在场景编辑器中，可以随时使用 <a href="../basics/editor-panels/scene.html#--11">缩放变换工具</a> 来修改节点缩放。</p>
<h3 id="-size-">尺寸（Size）</h3>
<p><strong>尺寸（Size）</strong> 属性由 <code>Width</code>（宽度）和 <code>Height</code> （高度）两个值组成，用来规定节点的约束框大小。对于 Sprite 节点来说，约束框的大小也就相当于显示图像的大小。</p>
<p>因此尺寸属性很容易和缩放属性混淆，两者都会影响 Sprite 图像的大小，但他们是通过不同的方式来影响图像实际显示大小的。尺寸属性和位置、锚点一起，规定了节点四个顶点所在位置，并由此决定由四个顶点约束的图像显示的范围。尺寸属性在渲染 <a href="../ui/sliced-sprite.html">九宫格图像（Sliced Sprite）</a> 时有至关重要的作用。</p>
<p>而缩放属性是在尺寸数值的基础上进行相乘，得到节点经过缩放后的宽度和高度。可以说在决定图像大小时，尺寸是基础，缩放是变量。另外尺寸属性不会直接影响子节点的尺寸（但可以通过 <a href="../ui/widget-align.html">对齐挂件（Widget）</a>间接影响），这一点和缩放属性有很大区别。</p>
<p>在场景编辑器中，可以随时使用 <a href="../basics/editor-panels/scene.html#--11">矩形变换工具</a> 来修改节点尺寸。</p>
<hr>
<p>继续前往 <a href="./node-tree.html">管理节点层级和显示顺序</a> 说明文档。</p>
      </article>
    </div>
  </div>
  <script src="../assets/js/anchor.min.js"></script>
  <script>
    anchors.add('article h2, article h3, article h4');
  </script>
  </body>
</html>
