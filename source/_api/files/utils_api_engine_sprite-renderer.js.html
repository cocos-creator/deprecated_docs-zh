<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils/api/engine/sprite-renderer.js - fireball-build</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                <a href="http://docs-zh.fireball-x.com">
                        <img class="logo" src="http://docs-zh.fireball-x.com/images/logo.png" title="fireball-build">
                </a>
                    <h1 class="project-name">fireball-build</h1> <span class="project-version">0.3.0</span>
                    <p class="description">Fireball is the game engine for the future.</p>
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">index</a></li>
                <li><a href="#top" class="top-jump-link">top</a></li>
            </ul>
        </div>
    </header>
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs"><div id="api-list">
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-enums">枚举</a></li>
            <li><a href="#api-classes">类型</a></li>
            <li><a href="#api-modules">模组</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="输入关键词，过滤API">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-enums" class="apis enums">
                <li>
                    <a href="../enums/FontType.html">FontType</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a href="../enums/TextAlign.html">TextAlign</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a href="../enums/TextAnchor.html">TextAnchor</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
            </ul>

            <ul id="api-classes" class="apis classes">
                <li>
                    <a class="type" href="../classes/_CallbacksHandler.html">_CallbacksHandler</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/_DeserializeInfo.html">_DeserializeInfo</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/_ObjectFlags.html">_ObjectFlags</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/_Runtime.RenderContext.html">_Runtime.RenderContext</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AnimationNode.html">AnimationNode</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AnimCurve.html">AnimCurve</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Asset.html">Asset</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AssetBundleBase.html">AssetBundleBase</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AssetLibrary.html">AssetLibrary</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AtlasAsset.html">AtlasAsset</a>
                    <a href="../modules/Fire.Spine.html" class="api-list-item-module">@Fire.Spine</a>
                </li>
                <li>
                    <a class="type" href="../classes/AudioClip.html">AudioClip</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/AudioSource.html">AudioSource</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/BitmapFont.html">BitmapFont</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/BitmapText.html">BitmapText</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/CallbacksInvoker.html">CallbacksInvoker</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Camera.html">Camera</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Color.html">Color</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Component.html">Component</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/ContentStrategyType.html">ContentStrategyType</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/DynamicAnimCurve.html">DynamicAnimCurve</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Engine.html">Engine</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Entity.html">Entity</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/EqualToFrame.html">EqualToFrame</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Event.html">Event</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/EventTarget.html">EventTarget</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/FixedHeight.html">FixedHeight</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/FObject.html">FObject</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/FontFlagType.html">FontFlagType</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/HashObject.html">HashObject</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Input.html">Input</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/InputField.html">InputField</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Intersection.html">Intersection</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/KeyboardEvent.html">KeyboardEvent</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/LoadManager.html">LoadManager</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Matrix23.html">Matrix23</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/ModifierKeyStates.html">ModifierKeyStates</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/MouseEvent.html">MouseEvent</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/NoScale.html">NoScale</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Path.html">Path</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Playable.html">Playable</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/PlaybackDirection.html">PlaybackDirection</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Rect.html">Rect</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Renderer.html">Renderer</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Resources.html">Resources</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/ResourcesBundle.html">ResourcesBundle</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Screen.html">Screen</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Screen.ContainerStrategy.html">Screen.ContainerStrategy</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Screen.ContentStrategy.html">Screen.ContentStrategy</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Skeleton.html">Skeleton</a>
                    <a href="../modules/Fire.Spine.html" class="api-list-item-module">@Fire.Spine</a>
                </li>
                <li>
                    <a class="type" href="../classes/SkeletonDataAsset.html">SkeletonDataAsset</a>
                    <a href="../modules/Fire.Spine.html" class="api-list-item-module">@Fire.Spine</a>
                </li>
                <li>
                    <a class="type" href="../classes/SkeletonRenderer.html">SkeletonRenderer</a>
                    <a href="../modules/Fire.Spine.html" class="api-list-item-module">@Fire.Spine</a>
                </li>
                <li>
                    <a class="type" href="../classes/Sprite.html">Sprite</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteAnimation.html">SpriteAnimation</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteAnimationClip.html">SpriteAnimationClip</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteAnimationClip.StopAction.html">SpriteAnimationClip.StopAction</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteAnimationClip.WrapMode.html">SpriteAnimationClip.WrapMode</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteAnimationState.html">SpriteAnimationState</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/SpriteRenderer.html">SpriteRenderer</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Texture.html">Texture</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Texture.FilterMode.html">Texture.FilterMode</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Texture.WrapMode.html">Texture.WrapMode</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Time.html">Time</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Transform.html">Transform</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
                <li>
                    <a class="type" href="../classes/Vec2.html">Vec2</a>
                    <a href="../modules/Fire.html" class="api-list-item-module">@Fire</a>
                </li>
            </ul>

            <ul id="api-modules" class="apis modules">
                <li><a class="module" href="../modules/Editor.html">Editor</a></li>
                <li><a class="module" href="../modules/Fire.html">Fire</a></li>
                <li><a class="module" href="../modules/Fire.JS.html">Fire.JS</a></li>
                <li><a class="module" href="../modules/Fire.Spine.html">Fire.Spine</a></li>
                <li><a class="module" href="../modules/Math.html">Math</a></li>
            </ul>
        </div>
    </div>
</div>
</div>

        <div id="docs-main" class="apidocs">
            <div class="content container"><h1 class="file-heading">文件: utils/api/engine/sprite-renderer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * @module Fire
 */
var tmpMat23 = new Fire.Matrix23();

/**
 * Renders a sprite in the scene.
 * @class SpriteRenderer
 * @extends Renderer
 * @constructor
 */
var SpriteRenderer = Fire.Class({
    name: &#x27;Fire.SpriteRenderer&#x27;,
    extends: Renderer,
    constructor: function () {
        RenderContext.initRenderer(this);
    },

    properties: {
        _sprite: null,

        /**
         * The sprite to render.
         * @property sprite
         * @type {Sprite}
         * @default null
         */
        sprite: {
            get: function () {
                return this._sprite;
            },
            set: function (value) {
                this._sprite = value;
                if (this.isOnLoadCalled) {
                    Engine._renderContext.updateMaterial(this);
                }
            },
            type: Fire.Sprite
        },

        _color: Fire.Color.white,

        /**
         * !#en The rendering color.
         * !#zh Sprite 渲染的颜色，其中 alpha 为 1 时表示不透明，0.5 表示半透明，0 则全透明。
         * @property color
         * @type Color
         * @default Fire.Color.white
         */
        color: {
            get: function () {
                return this._color;
            },
            set: function (value) {
                this._color = value;
                if (this.isOnLoadCalled) {
                    Engine._renderContext.updateColor(this);
                }
            }
        },

        _useCustomSize: false,

        /**
         * !#en Indicates that this renderer uses custom width and height to render the sprite.
         * !#zh 是否使用自定义尺寸渲染。
         * - 为 true 时将忽略 sprite 的大小，使用 customWidth 和 customHeight 进行渲染。
         * - 为 false 则使用 sprite 原有的 width 和 height 进行渲染。
         *
         * @property useCustomSize
         * @type {boolean}
         * @default false
         */
        useCustomSize: {
            get: function () {
                return this._useCustomSize;
            },
            set: function (value) {
                this._useCustomSize = value;
            }
        },

        width_: {
            default: 100,
            visible: false
        },

        /**
         * The custom width of this renderer.
         *
         * @property customWidth
         * @type {number}
         */
        customWidth: {
            get: function () {
                return this.width_;
            },
            set: function (value) {
                this.width_ = value;
            },
            watch: {
                _useCustomSize: function (obj, propEL) {
                    propEL.disabled = !obj._useCustomSize;
                }
            }
        },

        /**
         * !#en Get the render width of this renderer.
         * !#zh 获取该 Renderer 的渲染宽度，如果 useCustomSize 为 true，获取到的是 custom width，否则是 sprite width。
         *
         * @property renderWidth
         * @type {number}
         * @readOnly
         */
        renderWidth: {
            get: function () {
                if (this._useCustomSize) {
                    return this.width_;
                }
                else {
                    return Fire.isValid(this._sprite) ? this._sprite.width : 0;
                }
            },
            visible: false
        },

        height_: {
            default: 100,
            visible: false
        },

        /**
         * The custom height of this renderer.
         *
         * @property height
         * @type {number}
         */
        customHeight: {
            get: function () {
                return this.height_;
            },
            set: function (value) {
                this.height_ = value;
            },
            watch: {
                _useCustomSize: function (obj, propEL) {
                    propEL.disabled = !obj._useCustomSize;
                }
            }
        },

        /**
         * !#en Get the render height of this renderer.
         * !#zh 获取该 Renderer 的渲染高度，如果 useCustomSize 为 true，获取到的是 custom height，否则是 sprite height。
         *
         * @property height
         * @type {number}
         * @readOnly
         */
        renderHeight: {
            get: function () {
                if (this._useCustomSize) {
                    return this.height_;
                }
                else {
                    return Fire.isValid(this._sprite) ? this._sprite.height : 0;
                }
            },
            visible: false
        }
    },

    // built-in functions

    onLoad: function () {
        Engine._renderContext.addSprite(this);
    },
    onEnable: function () {
        Engine._renderContext.show(this, true);
    },
    onDisable: function () {
        Engine._renderContext.show(this, false);
    },

    getWorldSize: function () {
        return new Fire.Vec2(this.renderWidth, this.renderHeight);
    },


    onPreRender: function () {
        this.getSelfMatrix(tmpMat23);
        if (this._sprite) {
            // calculate render matrix
            //   scale
            tmpMat23.a = this.renderWidth / this._sprite.width;
            tmpMat23.d = this.renderHeight / this._sprite.height;
            //   rotate cw
            if (this._sprite.rotated) {
                tmpMat23.b = tmpMat23.d;
                tmpMat23.c = -tmpMat23.a;
                tmpMat23.a = 0;
                tmpMat23.d = 0;
                tmpMat23.ty -= this.height;
            }
        }
        tmpMat23.prepend(this.transform._worldTransform);
        Engine._curRenderContext.updateTransform(this, tmpMat23);
    },
    onDestroy: function () {
        Engine._renderContext.remove(this);
    },

    getSelfMatrix: function (out) {
        var w = this.renderWidth;
        var h = this.renderHeight;

        var pivotX = 0.5;
        var pivotY = 0.5;

        //var rotated = false;
        if (Fire.isValid(this._sprite)) {
            //rotated = this._sprite.rotated;
            pivotX = this._sprite.pivot.x;
            pivotY = this._sprite.pivot.y;
        }

        //if ( !rotated ) {
            out.a = 1;
            out.b = 0;
            out.c = 0;
            out.d = 1;
            out.tx = - pivotX * w;
            out.ty = (1.0 - pivotY) * h;
        //}
        //else {
        //    // CCW
        //    //out.a = 0;
        //    //out.b = scaleY;
        //    //out.c = -scaleX;
        //    //out.d = 0;
        //    //out.tx = - (pivotY - 1.0) * w;
        //    //out.ty = - pivotX * h;
        //
        //    // CW
        //    out.a = 0;
        //    out.b = -scaleY;
        //    out.c = scaleX;
        //    out.d = 0;
        //    out.tx = (1.0 - pivotX) * w;
        //    out.ty = (1.0 - pivotY) * h;
        //}
    }
});

Fire.SpriteRenderer = SpriteRenderer;

Fire.addComponentMenu(SpriteRenderer, &#x27;Sprite Renderer&#x27;);
Fire.executeInEditMode(SpriteRenderer);

JS.getset(SpriteRenderer.prototype, &#x27;customSize_&#x27;,
    function () {
        Fire.warn(&quot;&#x27;SpriteRenderer.customSize_&#x27; is deprecated, use _useCustomSize instead ; )&quot;);
        return this._useCustomSize;
    },
    function (value) {
        Fire.warn(&quot;&#x27;SpriteRenderer.customSize_&#x27; is deprecated, use _useCustomSize instead ; )&quot;);
        this._useCustomSize = value;
    }
);
JS.getset(SpriteRenderer.prototype, &#x27;customSize&#x27;,
    function () {
        Fire.warn(&quot;&#x27;SpriteRenderer.customSize&#x27; is deprecated, use useCustomSize instead ; )&quot;);
        return this.useCustomSize;
    },
    function (value) {
        Fire.warn(&quot;&#x27;SpriteRenderer.customSize&#x27; is deprecated, use useCustomSize instead ; )&quot;);
        this.useCustomSize = value;
    }
);
JS.getset(SpriteRenderer.prototype, &#x27;width&#x27;,
    function () {
        Fire.warn(&quot;The getter of &#x27;SpriteRenderer.width&#x27; is deprecated, use renderWidth instead ; )&quot;);
        return this.renderWidth;
    },
    function (value) {
        Fire.warn(&quot;The setter &#x27;SpriteRenderer.width&#x27; is deprecated, use customWidth instead ; )&quot;);
        this.customWidth = value;
    }
);
JS.getset(SpriteRenderer.prototype, &#x27;height&#x27;,
    function () {
        Fire.warn(&quot;The getter of &#x27;SpriteRenderer.height&#x27; is deprecated, use renderHeight instead ; )&quot;);
        return this.renderHeight;
    },
    function (value) {
        Fire.warn(&quot;The setter &#x27;SpriteRenderer.height&#x27; is deprecated, use customHeight instead ; )&quot;);
        this.customHeight = value;
    }
);

    </pre>
</div>
</div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-offscreen-trigger.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
